---
inclusion: always
---

# Product Guidelines

YouTube-to-Notion Integration processes YouTube videos and creates AI-generated summaries in Notion databases with rich formatting and embedded content.

## Documentation Standards

### README Disclaimer Requirement
**CRITICAL**: The README.md file must always contain the AI agent disclaimer section immediately after the project description and before the feature list. This disclaimer is essential for transparency about the project's AI-generated nature.

Required disclaimer content:
- Project was fully created and maintained by AI agents
- Main development by [Kiro Dev](https://kiro.dev/) (Amazon) for core functionalities
- Support & maintenance by [Jules](https://jules.google.com) (Google) for minor changes and bug fixes
- Primary purpose is exploring AI agent capabilities and limitations
- All repository contents were generated by AI agents

**Never remove or modify this disclaimer without explicit user request.**

## Architecture Patterns

### Component-Based Design
- Use `ComponentFactory` for dependency injection and component creation
- All components implement abstract interfaces (`Storage`, `SummaryWriter`)
- `VideoProcessor` orchestrates the complete processing pipeline
- Each component validates configuration at initialization
- Use structured exception hierarchy from `utils/exceptions.py`

### Operation Modes
- **Web UI Mode** (`--ui`): Visual interface with real-time updates (recommended)
- **CLI Example Data** (`--example-data`): Demo mode with no API keys required
- **CLI YouTube** (`--url`): Single video processing via command line
- **CLI Batch** (`--urls`, `--file`): Multiple video processing via command line
- **Test**: Integration tests use `.env-test` with "YT Summaries [TEST]" database

## Web UI Standards

### User Interface Design
- **Three-Column Layout**: Queue → Processing → Completed (inspired by YouTube design)
- **Real-time Updates**: Server-Sent Events (SSE) for live status updates
- **Responsive Design**: Works on desktop and mobile devices
- **Visual Progress**: Clear indication of processing phases and progress
- **Error Recovery**: User-friendly error messages with retry capabilities

### Queue Management
- **Background Processing**: Videos process asynchronously with visual feedback
- **Status Tracking**: Real-time updates on processing phases (metadata, AI, storage)
- **Chat Log Access**: View AI conversation logs for each video (main + chunks)
- **Drag-and-Drop**: Visual interface for managing video queue
- **Batch Support**: Add multiple URLs simultaneously

### Real-time Features
- **Server-Sent Events**: Live updates without page refresh
- **Debounced Updates**: Efficient rendering with batched UI updates
- **Connection Recovery**: Automatic reconnection on network issues
- **Progress Indicators**: Visual feedback for long-running operations
- **Error Notifications**: Toast-style error messages with context

## Content Standards

### Notion Page Structure
- Embed YouTube video at top using video blocks
- Set video thumbnail as page cover image
- Convert `[8:05]` timestamps to clickable YouTube URLs
- Transform markdown to Notion rich text format

### AI Summary Requirements
- Use `GeminiSummaryWriter` for structured summaries
- **CRITICAL**: Pass YouTube URLs as FileData to Gemini API (not text prompts)
- **Long Video Processing**: Automatically split videos >45 minutes into overlapping chunks
- Support streaming responses with progress indicators
- Handle markdown: headers (H1-H3), lists, bold, italic, **nested formatting in tables**
- Automatic conversation logging to `chat_logs/` directory (including chunk-specific logs)

### Advanced Markdown Processing
- **Table Support**: Full table parsing with nested formatting (bold, italic, links)
- **Rich Text in Cells**: Each table cell supports complete markdown formatting
- **Code Block Preservation**: Markdown formatting ignored within code blocks
- **Property-Based Validation**: Robust parsing tested with generated edge cases

### Batch Processing
- Support multiple URLs with progress tracking ("Processing 3/10...")
- Continue processing on individual failures
- Parse API `retryDelay` responses and wait appropriately
- Cap retry delays to 5 seconds during testing
- Use concise output in batch mode

### Long Video Processing
- **Automatic Detection**: Videos >45 minutes (`MAX_VIDEO_DURATION_SECONDS = 2700`) are automatically split
- **Smart Chunking**: 45-minute chunks with 5-minute overlaps, 20-minute minimum chunks
- **Contextual Processing**: Each chunk receives context from previous summaries
- **Progress Tracking**: Clear indication of chunk processing ("Processing chunk 2/4...")
- **Duration Extraction**: Parse video duration from YouTube API and web scraping fallback

## Quality Standards

### Error Handling
- Return boolean success indicators from main functions
- Use specific exceptions: `VideoProcessingError`, `ConfigurationError`, etc.
- Implement graceful fallbacks (YouTube API → web scraping)
- Provide user-friendly error messages with troubleshooting context

### Testing Workflow
- **Primary Python**: Unit tests for daily development (`python run_tests.py` - 478+ tests, ~6s)
- **Primary JavaScript**: Frontend component tests (`npm test` - Jest framework)
- **Secondary**: Integration tests for releases (`python run_integration_tests.py` - 13+ tests, ~90s)
- **Web UI Testing**: Manual testing via `--ui` mode for user workflows
- Use mock implementations from `tests/fixtures/mock_implementations.py`
- Unit tests must not perform I/O or call external APIs
- JavaScript tests use Jest with mocked SSE connections

### Database Integration
- Use `NotionStorage` implementation of `Storage` interface
- **CRITICAL**: Implement block batching for summaries >100 blocks
- Automatically discover target databases by name
- Check for duplicates before creating pages
- Map video metadata to Notion page properties (including duration)
- Handle Notion's 100-block limit with automatic batching (first 100 blocks + append remaining)
- Support long-form content from chunked video processing

## Web Architecture Standards

### FastAPI Server Design
- **RESTful API**: JSON endpoints for queue operations and status
- **Server-Sent Events**: Real-time streaming updates to web clients
- **Static File Serving**: HTML, CSS, JavaScript components
- **Static File Serving**: Direct serving of HTML, CSS, JavaScript files
- **Auto-launch**: Automatically opens browser on startup
- **Error Handling**: Structured HTTP error responses with context

### Frontend Architecture
- **Vanilla JavaScript**: ES6+ features, no external frameworks
- **Component-Based**: Modular components (`url-input.js`, `queue-columns.js`, `sse-connection.js`)
- **Event-Driven**: Custom events for component communication
- **State Management**: Local state with SSE synchronization
- **Error Boundaries**: Graceful error handling with user feedback
- **Accessibility**: ARIA labels and keyboard navigation support

### Queue Management System
- **Background Processing**: `QueueManager` handles async video processing
- **Status Tracking**: Real-time updates on processing phases
- **Chat Log Integration**: Both main logs and chunk logs accessible
- **Error Recovery**: Retry failed items with improved error context
- **Memory Management**: Efficient handling of large video queues